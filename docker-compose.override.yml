# Local development overrides - automatically loaded with docker-compose.yml
# Requires CVT SDK cloned at ../../cvt (run: make setup-symlink)
#
# Expected directory structure:
#   workspaces/
#     cvt/sdks/{go,node,python}  <- CVT SDK
#     cvt-demo/<repo>/           <- This repo

services:
  # Producer - Go Calculator API (build from local source)
  producer:
    build:
      context: ..
      dockerfile: cvt-demo/producer/Dockerfile
    container_name: producer
    ports:
      - "10001:10001"
    environment:
      - PORT=10001
      - CVT_SERVER_ADDR=cvt-server:9550
      - SCHEMA_PATH=/app/calculator-api.yaml
      - CVT_ENABLED=true
    depends_on:
      cvt-server:
        condition: service_healthy
    networks:
      - cvt-demo-network
    restart: unless-stopped

  # Consumer-1 - Node.js CLI (build from local source)
  consumer-1:
    build:
      context: ..
      dockerfile: cvt-demo/consumer-1/Dockerfile
    environment:
      - PRODUCER_URL=http://producer:10001
      - CVT_SERVER_ADDR=cvt-server:9550
      - SCHEMA_PATH=/app/calculator-api.json
    depends_on:
      - producer
    networks:
      - cvt-demo-network
    profiles:
      - cli

  # Consumer-2 - Python CLI (build from local source)
  consumer-2:
    build:
      context: ..
      dockerfile: cvt-demo/consumer-2/Dockerfile
    environment:
      - PRODUCER_URL=http://producer:10001
      - CVT_SERVER_ADDR=cvt-server:9550
      - SCHEMA_PATH=/app/calculator-api.json
    depends_on:
      - producer
    networks:
      - cvt-demo-network
    profiles:
      - cli
