# Base Docker Compose - shared configuration
# Local dev: automatically merges with docker-compose.override.yml
# CI: use docker-compose -f docker-compose.yml -f docker-compose.ci.yml

services:
  # CVT Server - Contract validation service (pre-built image)
  cvt-server:
    image: ghcr.io/sahina/cvt-server:${CVT_SERVER_VERSION:-0.1.0-alpha.1}
    container_name: cvt-server
    ports:
      - "9550:9550"   # gRPC port
      - "9551:9551"   # Metrics port
    environment:
      - LOG_LEVEL=info
      - CVT_PORT=9550
      - CVT_METRICS_PORT=9551
      - CVT_STORAGE_ENABLED=false
    networks:
      - cvt-demo-network
    healthcheck:
      test: ["CMD", "/bin/grpc_health_probe", "-addr=:9550"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s
    restart: unless-stopped

networks:
  cvt-demo-network:
    driver: bridge
